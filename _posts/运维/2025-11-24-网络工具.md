---
layout: post
title: 网络工具
date: 2025-11-24 11:00 +0800
categories: [网络, 运维]
tags: [网络工具]
---

常用网络诊断与排障工具的速查合集，覆盖连通性、DNS、端口、HTTP、性能、抓包与扫描等常见场景，附最常用命令示例。

## 连通性
Ping、Traceroute、MTR 用于检查主机是否可达与路径跳数。

```bash
# 连续发送 4 个包
ping -c 4 example.com

# 路由路径查看（macOS/Linux）
traceroute example.com

# 路由与质量（需要安装 mtr）
mtr -rw example.com
```

## DNS 解析
Dig 与 Nslookup 用于查看域名解析结果与权威链路。

```bash
# A 记录精简输出
dig A example.com +short

# 指定 DNS 服务器解析
dig @8.8.8.8 example.com

# 追踪权威解析链路
dig +trace example.com

# Nslookup 基本用法
nslookup example.com
```

## 端口与连接
Netcat、Telnet、ss/netstat 用于测试端口连通与监听情况。

```bash
# TCP 端口探测（常用）
nc -vz 1.2.3.4 443

# 旧工具（部分系统可用）
telnet 1.2.3.4 80

# 查看监听端口（Linux）
ss -tln

# 查看监听端口（macOS/通用）
netstat -an | grep LISTEN
```

## HTTP 调试
Curl 适用于协议级别调试、请求重试与头信息查看。

```bash
# 仅看响应头
curl -I https://example.com

# 详细握手与头信息
curl -v https://example.com

# 指定 Host 到自定义 IP（排障常用）
curl --resolve example.com:443:1.2.3.4 https://example.com
```

## 带宽与时延
Iperf3 用于端到端带宽测试，需一端作为服务端。

```bash
# 服务端
iperf3 -s

# 客户端（连接到服务端）
iperf3 -c 1.2.3.4
```

## 抓包分析
Tcpdump 与 Wireshark 用于数据包级排查与协议分析。

```bash
# 抓取 443 端口数据（任意网卡）
sudo tcpdump -i any port 443 -nn

# 过滤 SSH 流量（指定网卡）
sudo tcpdump -i en0 'tcp port 22' -nn
```

## 扫描与探测
Nmap 用于端口扫描与服务识别，注意遵守使用场景与合规要求。

```bash
# 常用 TCP SYN 扫描，识别常见端口
sudo nmap -sS -Pn 1.2.3.4 -p 1-1024

# 服务与版本识别
sudo nmap -sV 1.2.3.4 -p 80,443
```

## 路由与接口
查看接口、IP、路由信息以定位本机网络配置问题。

```bash
# Linux 接口与地址
ip a

# Linux 路由
ip route

# macOS/通用接口与地址
ifconfig

# macOS/通用路由
route -n
```

## 网卡与速率
ifconfig 与 ethtool 用于查看与配置接口状态、速率与双工。

```bash
# macOS：启用/禁用接口
sudo ifconfig en0 up
sudo ifconfig en0 down

# macOS：修改 MTU
sudo ifconfig en0 mtu 1500

# Linux：查看速率/双工/链路状态与驱动信息
sudo ethtool eth0
sudo ethtool -i eth0
sudo ethtool eth0 | grep -E 'Speed|Duplex|Link detected'

# Linux：查看网卡特性与统计
sudo ethtool -k eth0
sudo ethtool -S eth0

# Linux：设置速率与双工（需设备与驱动支持）
sudo ethtool -s eth0 speed 1000 duplex full autoneg on
```

## 防火墙与 NAT
iptables（传统）、nftables（新架构）、ufw/firewalld（高层封装）常用于端口放行与 NAT 配置。

```bash
# iptables：查看规则（filter 表）
sudo iptables -L -n -v

# iptables：放行 TCP 80 端口
sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT

# iptables：拒绝来自指定源的流量
sudo iptables -A INPUT -s 1.2.3.4 -j DROP

# iptables：查看/配置 NAT（源地址伪装）
sudo iptables -t nat -L -n -v
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# iptables：保存/恢复（不同发行版方式不同）
sudo iptables-save > /etc/iptables/rules.v4
sudo iptables-restore < /etc/iptables/rules.v4

# nftables：查看完整规则集
sudo nft list ruleset

# nftables：示例放行 HTTP（需按实际表/链调整）
sudo nft add rule inet filter input tcp dport 80 ct state new accept

# ufw（Ubuntu 常用）：查看与放行
sudo ufw status
sudo ufw allow 80/tcp
sudo ufw delete allow 80/tcp

# firewalld（RHEL/CentOS 常用）：查看与放行
sudo firewall-cmd --list-all
sudo firewall-cmd --add-service=http --permanent
sudo firewall-cmd --reload
```

## 其他常用

```bash
# 域名注册信息
whois example.com

# ARP 表
arp -a

# DNS MX 记录
dig MX example.com +short
```

## 排障流程建议
- 明确目标：域名、IP、端口、协议与期望行为。
- 本机检查：接口、IP、路由、DNS 与防火墙策略。
- 连通性链路：`ping`/`traceroute`/`mtr` 逐跳定位。
- 端口与服务：`nc`/`ss`/`netstat` 确认监听与访问。
- 协议层验证：`curl -v` 观察握手与状态码。
- 抓包定位：`tcpdump`/Wireshark 分析握手与重传。
- 服务器侧验证：日志、监听、ACL 与负载均衡策略。
